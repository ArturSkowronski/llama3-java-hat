<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>llama3-java-hat Benchmarks</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, monospace;
            background: #0d1117;
            color: #c9d1d9;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #58a6ff;
            font-size: 1.8rem;
            margin-bottom: 0.3rem;
        }
        .subtitle {
            color: #8b949e;
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
        }
        .disclaimer {
            background: #161b22;
            border: 1px solid #f0883e;
            border-radius: 6px;
            padding: 0.8rem 1rem;
            margin-bottom: 1.5rem;
            font-size: 0.85rem;
            color: #f0883e;
        }
        .chart-container {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        .chart-container canvas {
            max-height: 400px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        th, td {
            padding: 0.6rem 0.8rem;
            text-align: left;
            border-bottom: 1px solid #21262d;
        }
        th {
            background: #161b22;
            color: #58a6ff;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        tr:hover { background: #161b22; }
        td.num { text-align: right; font-variant-numeric: tabular-nums; }
        .backend-plain { color: #7ee787; }
        .backend-seq { color: #79c0ff; }
        .backend-mt { color: #d2a8ff; }
        .backend-opencl { color: #ffa657; }
        .error { color: #f85149; }
        .no-data {
            text-align: center;
            padding: 3rem;
            color: #8b949e;
            font-size: 1.1rem;
        }
        footer {
            margin-top: 2rem;
            text-align: center;
            color: #484f58;
            font-size: 0.8rem;
        }
        footer a { color: #58a6ff; text-decoration: none; }
    </style>
</head>
<body>
    <h1>llama3-java-hat Inference Benchmarks</h1>
    <p class="subtitle">Llama 3.2 1B Instruct (FP16) &mdash; Tokens/sec across HAT backends</p>

    <div class="disclaimer">
        These benchmarks are for fun only. Results are collected on GitHub Actions runners
        with variable performance characteristics. Do not use these numbers for serious
        performance comparisons. The OpenCL backend runs on PoCL (CPU-based OpenCL), not a real GPU &mdash; expect significantly lower throughput than actual GPU hardware.
    </div>

    <div class="chart-container">
        <canvas id="benchmarkChart"></canvas>
    </div>

    <div id="tableContainer"></div>

    <footer>
        <a href="https://github.com/ArturSkowronski/llama3-java-hat">llama3-java-hat</a>
        &mdash; Project Babylon HAT inference
    </footer>

    <!-- DATA_PLACEHOLDER: replaced by CI with actual benchmark data -->
    <script>window.BENCHMARK_DATA = {"runs":[{"date":"2026-02-19T12:55:55+01:00","commit":"383309b1862ab99435b0caca705731724aa525d5","results":{"Plain Java":{"load_sec":8.916182237,"infer_sec":300.940058824,"tok_per_sec":0.026583366904565777},"HAT Java Sequential":{"load_sec":9.097154525,"infer_sec":400.977132137,"tok_per_sec":0.019951262450714213},"HAT Java MT":{"load_sec":9.055971605,"infer_sec":162.61974887,"tok_per_sec":0.049194516998026405},"HAT OpenCL GPU":{"load_sec":-1.0,"infer_sec":-1,"tok_per_sec":-1,"error":"SKIPPED: Set RUN_OPENCL_BENCHMARKS=true to enable"}}},{"date":"2026-02-19T11:56:00Z","commit":"383309b1862ab99435b0caca705731724aa525d5","results":{"Plain Java":{"load_sec":8.961723709,"infer_sec":301.046938359,"tok_per_sec":0.02657392911420331},"HAT Java Sequential":{"load_sec":8.94802729,"infer_sec":400.399037943,"tok_per_sec":0.019980067986923745},"HAT Java MT":{"load_sec":9.339524945,"infer_sec":163.328864198,"tok_per_sec":0.04898093205559659},"HAT OpenCL GPU":{"load_sec":-1.0,"infer_sec":-1,"tok_per_sec":-1,"error":"SKIPPED: Set RUN_OPENCL_BENCHMARKS=true to enable"}}},{"date":"2026-02-19T13:20:45Z","commit":"383309b1862ab99435b0caca705731724aa525d5","results":{"Plain Java":{"load_sec":9.139021398,"infer_sec":307.042356691,"tok_per_sec":0.026055037116755216},"HAT Java Sequential":{"load_sec":9.056386863,"infer_sec":431.681679961,"tok_per_sec":0.018532173986912658},"HAT Java MT":{"load_sec":9.374655179,"infer_sec":210.198314876,"tok_per_sec":0.03805929654916288},"HAT OpenCL GPU":{"load_sec":-1.0,"infer_sec":-1,"tok_per_sec":-1,"error":"SKIPPED: Set RUN_OPENCL_BENCHMARKS=true to enable"}}},{"date":"2026-02-19T13:20:45Z","commit":"4162ce0ca224ad137c87ad9b59344d003314fafa","results":{"Plain Java":{"load_sec":9.386617193,"infer_sec":298.366258975,"tok_per_sec":0.02681268326882202},"HAT Java Sequential":{"load_sec":9.217948364,"infer_sec":404.852235277,"tok_per_sec":0.019760295986821955},"HAT Java MT":{"load_sec":9.346411893,"infer_sec":167.605263856,"tok_per_sec":0.047731197791456556},"HAT OpenCL GPU":{"load_sec":-1.0,"infer_sec":-1,"tok_per_sec":-1,"error":"ServiceConfigurationError"}}},{"date":"2026-02-19T15:27:57+01:00","commit":"ec92f6bcf727938d31238b8777da93cc344c16a5","results":{"Plain Java":{"load_sec":9.1014418,"infer_sec":297.86070869,"tok_per_sec":0.02685819165335445},"HAT Java Sequential":{"load_sec":8.946748362,"infer_sec":308.171990094,"tok_per_sec":0.025959529928595404},"HAT Java MT":{"load_sec":9.164769441,"infer_sec":208.879541894,"tok_per_sec":0.0382995861033617},"HAT OpenCL GPU":{"load_sec":-1.0,"infer_sec":-1,"tok_per_sec":-1,"error":"ServiceConfigurationError"}}},{"date":"2026-02-19T15:43:36+01:00","commit":"b277b3dd0acdb120f399a938825b0e1ca486b760","results":{"Plain Java":{"load_sec":9.276655025,"infer_sec":302.014999856,"tok_per_sec":0.026488750571376854},"HAT Java Sequential":{"load_sec":9.087319702,"infer_sec":412.78845717,"tok_per_sec":0.0193803868810831},"HAT Java MT":{"load_sec":9.098301014,"infer_sec":163.094842058,"tok_per_sec":0.04905121399949012},"HAT OpenCL GPU":{"load_sec":-1.0,"infer_sec":-1,"tok_per_sec":-1,"error":"SKIPPED: No runtime available"}}},{"date":"2026-02-19T16:51:32+01:00","commit":"a3831af6cd31becaf809b11e7c76ac9df9a3f8f0","results":{"Plain Java":{"load_sec":9.222941593,"infer_sec":295.079718113,"tok_per_sec":0.027111317752229996},"HAT Java Sequential":{"load_sec":8.967346922,"infer_sec":314.787286608,"tok_per_sec":0.025413986969436548},"HAT Java MT":{"load_sec":9.080211227,"infer_sec":163.144145151,"tok_per_sec":0.04903639044230183},"HAT OpenCL GPU":{"load_sec":-1.0,"infer_sec":-1,"tok_per_sec":-1,"error":"SKIPPED: No runtime available"}}},{"date":"2026-02-19T15:51:37Z","commit":"a3831af6cd31becaf809b11e7c76ac9df9a3f8f0","results":{"Plain Java":{"load_sec":8.980076085,"infer_sec":313.941468398,"tok_per_sec":0.025482457098843603},"HAT Java Sequential":{"load_sec":9.439705821,"infer_sec":315.13944583,"tok_per_sec":0.02538558757355799},"HAT Java MT":{"load_sec":9.393594168,"infer_sec":207.401619859,"tok_per_sec":0.038572504908296876},"HAT OpenCL GPU":{"load_sec":-1.0,"infer_sec":-1,"tok_per_sec":-1,"error":"SKIPPED: No runtime available"}}}]};</script>

    <script>
    (function() {
        const data = window.BENCHMARK_DATA;
        const runs = data.runs || [];

        if (runs.length === 0) {
            document.getElementById('tableContainer').innerHTML =
                '<div class="no-data">No benchmark data yet. Run the benchmark-pages workflow to populate.</div>';
            return;
        }

        const backends = [
            { key: 'Plain Java', color: '#7ee787', cssClass: 'backend-plain' },
            { key: 'HAT Java Sequential', color: '#79c0ff', cssClass: 'backend-seq' },
            { key: 'HAT Java MT', color: '#d2a8ff', cssClass: 'backend-mt' },
            { key: 'HAT OpenCL GPU', color: '#ffa657', cssClass: 'backend-opencl' }
        ];

        // --- Chart ---
        const labels = runs.map(r => {
            const d = new Date(r.date);
            return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })
                + '\n' + r.commit.substring(0, 7);
        });

        const datasets = backends.map(b => ({
            label: b.key,
            data: runs.map(r => {
                const res = r.results[b.key];
                return (res && !res.error && res.tok_per_sec > 0) ? res.tok_per_sec : null;
            }),
            borderColor: b.color,
            backgroundColor: b.color + '33',
            tension: 0.3,
            pointRadius: 4,
            pointHoverRadius: 6,
            spanGaps: true
        }));

        new Chart(document.getElementById('benchmarkChart'), {
            type: 'line',
            data: { labels, datasets },
            options: {
                responsive: true,
                interaction: { mode: 'index', intersect: false },
                plugins: {
                    legend: {
                        labels: { color: '#c9d1d9', usePointStyle: true, pointStyle: 'circle' }
                    },
                    tooltip: {
                        callbacks: {
                            label: ctx => ctx.dataset.label + ': ' + (ctx.parsed.y != null ? ctx.parsed.y.toFixed(2) + ' tok/s' : 'N/A')
                        }
                    }
                },
                scales: {
                    x: {
                        ticks: { color: '#8b949e', maxRotation: 45 },
                        grid: { color: '#21262d' }
                    },
                    y: {
                        title: { display: true, text: 'Tokens / sec', color: '#8b949e' },
                        ticks: { color: '#8b949e' },
                        grid: { color: '#21262d' },
                        beginAtZero: true
                    }
                }
            }
        });

        // --- Table ---
        let html = '<table><thead><tr>'
            + '<th>Date</th><th>Commit</th><th>Backend</th>'
            + '<th style="text-align:right">Load (s)</th>'
            + '<th style="text-align:right">Inference (s)</th>'
            + '<th style="text-align:right">Tok/sec</th>'
            + '<th>Status</th></tr></thead><tbody>';

        // Most recent first
        for (let i = runs.length - 1; i >= 0; i--) {
            const run = runs[i];
            const dateStr = new Date(run.date).toLocaleString('en-US', {
                year: 'numeric', month: 'short', day: 'numeric',
                hour: '2-digit', minute: '2-digit'
            });
            const commitShort = run.commit.substring(0, 7);

            for (const b of backends) {
                const res = run.results[b.key];
                if (!res) {
                    html += '<tr><td>' + dateStr + '</td><td><code>' + commitShort + '</code></td>'
                        + '<td class="' + b.cssClass + '">' + b.key + '</td>'
                        + '<td class="num">-</td><td class="num">-</td><td class="num">-</td>'
                        + '<td class="error">No data</td></tr>';
                    continue;
                }
                if (res.error) {
                    html += '<tr><td>' + dateStr + '</td><td><code>' + commitShort + '</code></td>'
                        + '<td class="' + b.cssClass + '">' + b.key + '</td>'
                        + '<td class="num">' + (res.load_sec >= 0 ? res.load_sec.toFixed(2) : '-') + '</td>'
                        + '<td class="num">-</td><td class="num">-</td>'
                        + '<td class="error">' + res.error + '</td></tr>';
                    continue;
                }
                html += '<tr><td>' + dateStr + '</td><td><code>' + commitShort + '</code></td>'
                    + '<td class="' + b.cssClass + '">' + b.key + '</td>'
                    + '<td class="num">' + res.load_sec.toFixed(2) + '</td>'
                    + '<td class="num">' + res.infer_sec.toFixed(2) + '</td>'
                    + '<td class="num">' + res.tok_per_sec.toFixed(2) + '</td>'
                    + '<td>OK</td></tr>';
            }
        }

        html += '</tbody></table>';
        document.getElementById('tableContainer').innerHTML = html;
    })();
    </script>
</body>
</html>
